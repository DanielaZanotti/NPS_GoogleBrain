bfitout<-as.matrix(bfit)
apply(bfitout,2,mean)
apply(bfitout,2,sd)
x11()
par(mfrow=c(1,3))
plot(density(bfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(bfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(bfitout[,3]), xlab='beta2 - male',main=' ')
dev.off()
x11()
par(mfrow=c(1,3))
plot(density(bfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(bfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(bfitout[,3]), xlab='beta2 - male',main=' ')
beta00=c(0,0,0); c0=10 #la prior ha un peso dell'1% rispetto al campione
## HOMEWORK:  c0=1 e c0=10
P0=t(X)%*%X/c0
P0
bfit <- MCMCprobit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="Chib95")
bfitout<-as.matrix(bfit)
apply(bfitout,2,mean)
apply(bfitout,2,sd)
x11()
par(mfrow=c(1,3))
plot(density(bfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(bfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(bfitout[,3]), xlab='beta2 - male',main=' ')
beta00=c(0,0,0); c0=1 #la prior ha un peso dell'1% rispetto al campione
## HOMEWORK:  c0=1 e c0=10
P0=t(X)%*%X/c0
P0
bfit <- MCMCprobit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="Chib95")
bfitout<-as.matrix(bfit)
apply(bfitout,2,mean)
apply(bfitout,2,sd)
x11()
par(mfrow=c(1,3))
plot(density(bfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(bfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(bfitout[,3]), xlab='beta2 - male',main=' ')
beta00=c(0,0,0); c0=100 #la prior ha un peso dell'1% rispetto al campione
?MCMClogit
Lfit <- MCMClogit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="Chib95")
Lfit <- MCMClogit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="None")
Lfit <- MCMClogit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="none")
Lfitout<-as.matrix(Lfit)
x11()
par(mfrow=c(1,3))
plot(density(Lfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(Lfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(Lfitout[,3]), xlab='beta2 - male',main=' ')
Lfit <- MCMClogit(y ~ donner$age +as.factor(donner$male), b0=beta00, B0=P0,marginal.likelihood="Laplace")
Lfitout<-as.matrix(Lfit)
x11()
par(mfrow=c(1,3))
plot(density(Lfitout[,1]), xlab='beta0 - intercept',main=' ')
plot(density(Lfitout[,2]), xlab='beta1 - age',main=' ')
plot(density(Lfitout[,3]), xlab='beta2 - male',main=' ')
setwd("~/UniversitÃ /5.1 Nonparametric statistics/Project/NPS_GoogleBrain")
library(readr)
library(tidyverse)
library(roahd)
library(fdakmapp)
set.seed(2304)
df <-  read.table("Data/train.csv",header=TRUE,sep=",")
num <- length(df$breath_id)
r_num <- sample(unique(df$breath_id), num*0.0005, replace = F)
length(r_num)
train_s <- df %>%
filter(breath_id %in% r_num)
attach(train_s)
train_s$n_change_sign_u_in <- 0
for (i in unique(train_s$breath_id)) {
x <- train_s[which(breath_id==i), 6]
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_s[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
detach(train_s)
train_s <- df %>%
filter(breath_id %in% r_num)
attach(train_s)
################
### R_c
################
train_s$R_C <- paste(as.character(train_s$R),as.character(train_s$C), sep ="_")
X<-split(train_s, train_s$R_C)
id_X = names(X
)
################
### CUMULATIVE SUM OF u_in
################
train_s$tot_u_in <- 0
for (i in unique(train_s$breath_id)) {
train_s[which(breath_id==i), 'tot_u_in'] <- cumsum(train_s[which(breath_id==i),6])
}
################
### FIRST AND LAST VALUE OF u_in
################
#since pressure would be getting closer to u_in in the end
train_s$last_u_in <- 0
for( i in seq(1,length(train_s$id),80))
{
xx <- train_s[i+79, 6]
id <- train_s[i+79, 2]
train_s[which(breath_id==id), 'last_u_in'] <- xx
}
train_s$first_u_in <- 0
for( i in seq(1,length(train_s$id),80))
{
xx <- train_s[i, 6]
id <- train_s[i, 2]
train_s[which(breath_id==id), 'first_u_in'] <- xx
}
###################
### MAX VALUE OF u_in FOR EACH BREATH
###################
train_s$max_u_in <- 0
for (i in unique(train_s$breath_id)) {
mx <- max(train_s[which(breath_id==i), 6])
train_s[which(breath_id==i), 'max_u_in'] <- mx
}
#####################
### DIFFERENCE BETWEEN CONSECUTIVE VALUES
#####################
train_s$u_in_diff1 <- 0
train_s$u_in_diff2 <- 0
for (i in unique(train_s$breath_id)) {
shift <- c(0, 0, train_s[which(breath_id==i), 6])
train_s[which(breath_id==i), 'u_in_diff1'] <- shift[3:82] - shift[2:81]
train_s[which(breath_id==i), 'u_in_diff2'] <- shift[3:82] - shift[1:80]
}
################
### DIFFERENCE BETWEEN CURRENT VALUE OF u_in AND THE MAX VALUE WITHIN THE BREATH
################
train_s$u_in_diff_max <- 0
for (i in unique(train_s$breath_id)) {
train_s[which(breath_id==i), 'u_in_diff_max'] <- train_s[which(breath_id==i), 6] - train_s[which(breath_id==i), 'max_u_in']
}
####################
### NUMBER OF CHANGE OF SIGN
####################
train_s$n_change_sign_u_in <- 0
for (i in unique(train_s$breath_id)) {
x <- train_s[which(breath_id==i), 6]
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_s[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
View(train_s)
train_s$n_change_sign_u_in <- 0
for (i in unique(train_s$breath_id)) {
x <- train_s[which(breath_id==i), 'u_in_diff1']
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_s[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
ts = data.frame()
for(i in seq(1,length(train_s$id),80) ){
x1 = train_s[i+79,]
ts = rbind(ts, x1)
}
plot(ts$n_change_sign_u_in)
cl.e <- dist(ts$n_change_sign_u_in, method='euclidean')
cl.ew <- hclust(cl.e, method='ward')
plot(cl.ew, main='euclidean-ward', hang=-0.1, xlab='', labels=F, cex=0.6, sub='')
rect.hclust(cl.ew, k=2)
func_data1=data.frame()
for(i in seq(1,length(train_s$id),80) ){
x1=train_s[i:(i+79),6]
func_data1 = rbind(func_data1, t(x1))
}
grid <-  seq( 1, 80)
f_data1 <- fData(grid,func_data1)
plot(train_s[which(id==3521), 'u_in'])
grid <-  seq( 1, 80)
f_data1 <- fData(grid,train_s[1:80, 'u_in'])
plot(f_data1)
f_data1 <- fData(grid,train_s[which(breath_id=392), 'u_in'])
f_data1 <- fData(grid,train_s[which(breath_id==392), 'u_in'])
plot(f_data1)
plot(cl.ew, main='euclidean-ward', hang=-0.1, xlab='', labels=F, cex=0.6, sub='')
cluster.ew <- cutree(cl.ew, k=2)
plot(ts$n_change_sign_u_in, col = cluster.ew)
cluster.ew
cluster.ew <- cutree(cl.ew, k=3)
plot(ts$n_change_sign_u_in, col = cluster.ew)
j = 1
for(i in seq(1,length(train_s$id),80) ){
train_s[i:(i+79),'clust'] = cluster.ew[j]
j = j +1
}
func_data1=data.frame()
for(i in seq(1,length(train_s$id),80) ){
x1=train_s[i:(i+79),5]
func_data1 = rbind(func_data1, t(x1))
}
#pressure
func_data4=data.frame()
for(i in seq(1,length(train_s$id),80) ){
x4=train_s[i:(i+79),8]
func_data4 = rbind(func_data4, t(x4))
}
grid <-  seq( 1, 80)
f_data4 <- fData(grid,func_data4)
plot(f_data4,main="pressure")
#u_in
func_data2=data.frame()
for(i in seq(1,length(train_s$id),80) ){
x2=train_s[i:(i+79),6]
func_data2 = rbind(func_data2, t(x2))
}
grid <-  seq( 1, 80)
f_data2 <- fData(grid,func_data2)
plot(f_data2,main="in")
#clust
func_data5 = data.frame()
for(i in seq(1,length(train_s$id),80) ){
x5 = train_s[i:(i+79),'clust']
func_data5 = rbind(func_data5, t(x5))
}
times = as.matrix(func_data1)
pr = as.matrix(func_data4)
uin = as.matrix(func_data2)
clu = as.matrix(func_data5)
x11()
matplot(t(times),t(pr), type='l', xlab='x', ylab='orig.func', col= clu)
matplot(t(times),t(uin), type='l', xlab='x', ylab='orig.func', col= clu)
train_until1 <- train_s %>% filter(u_in < 1)
View(train_until1)
train_until1 <- train_s %>% filter(time_step < 1)
View(train_until1)
attach(train_until1)
detach(train_s)
detach(train_s)
train_until1 <- train_s %>% filter(u_out == 0)
View(train_until1)
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
l = length(train_until1[which(breath_id==i),])
x1 = train_until1[l, ]
ts = rbind(ts, x1)
}
View(ts)
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
x1 = x1[-1, ]
ts = rbind(ts, x1)
}
View(ts)
x1 = train_until1[which(breath_id==54), ]
x1
x1[-1, ]
x1[c(-1),]
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
ts = rbind(ts, x1[l,])
}
View(ts)
plot(ts$n_change_sign_u_in)
cl.e <- dist(ts$n_change_sign_u_in, method='euclidean')
cl.ew <- hclust(cl.e, method='ward')
View(ts)
train_until1$n_change_sign_u_in <- 0
for (i in unique(train_until1$breath_id)) {
x <- train_until1[which(breath_id==i), 'u_in_diff1']
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_until1[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
################
### R_c
################
train_until1$R_C <- paste(as.character(train_until1$R),as.character(train_until1$C), sep ="_")
X<-split(train_until1, train_until1$R_C)
id_X = names(X
)
################
### CUMULATIVE SUM OF u_in
################
train_until1$tot_u_in <- 0
for (i in unique(train_until1$breath_id)) {
train_until1[which(breath_id==i), 'tot_u_in'] <- cumsum(train_until1[which(breath_id==i),6])
}
################
### FIRST AND LAST VALUE OF u_in
################
#since pressure would be getting closer to u_in in the end
train_until1$last_u_in <- 0
for( i in seq(1,length(train_until1$id),80))
{
xx <- train_until1[i+79, 6]
id <- train_until1[i+79, 2]
train_until1[which(breath_id==id), 'last_u_in'] <- xx
}
train_until1$first_u_in <- 0
for( i in seq(1,length(train_until1$id),80))
{
xx <- train_until1[i, 6]
id <- train_until1[i, 2]
train_until1[which(breath_id==id), 'first_u_in'] <- xx
}
###################
### MAX VALUE OF u_in FOR EACH BREATH
###################
train_until1$max_u_in <- 0
for (i in unique(train_until1$breath_id)) {
mx <- max(train_until1[which(breath_id==i), 6])
train_until1[which(breath_id==i), 'max_u_in'] <- mx
}
#####################
### DIFFERENCE BETWEEN CONSECUTIVE VALUES
#####################
train_until1$u_in_diff1 <- 0
train_until1$u_in_diff2 <- 0
for (i in unique(train_until1$breath_id)) {
shift <- c(0, 0, train_until1[which(breath_id==i), 6])
train_until1[which(breath_id==i), 'u_in_diff1'] <- shift[3:82] - shift[2:81]
train_until1[which(breath_id==i), 'u_in_diff2'] <- shift[3:82] - shift[1:80]
}
################
### DIFFERENCE BETWEEN CURRENT VALUE OF u_in AND THE MAX VALUE WITHIN THE BREATH
################
train_until1$u_in_diff_max <- 0
for (i in unique(train_until1$breath_id)) {
train_until1[which(breath_id==i), 'u_in_diff_max'] <- train_until1[which(breath_id==i), 6] - train_until1[which(breath_id==i), 'max_u_in']
}
####################
### NUMBER OF CHANGE OF SIGN
####################
train_until1$n_change_sign_u_in <- 0
for (i in unique(train_until1$breath_id)) {
x <- train_until1[which(breath_id==i), 'u_in_diff1']
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_until1[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
View(train_until1)
train_until1$last_u_in <- 0
for( i in  unique(train_until1$breath_id))
{
x = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
train_until1[which(breath_id==i), 'last_u_in'] <- x[l,'u_in']
}
train_until1$first_u_in <- 0
for( i in unique(train_until1$breath_id))
{
x = train_until1[which(breath_id==i), ]
train_until1[which(breath_id==i), 'first_u_in'] <- x[1,'u_in']
}
train_until1$max_u_in <- 0
for (i in unique(train_until1$breath_id)) {
mx <- max(train_until1[which(breath_id==i), 'u_in'])
train_until1[which(breath_id==i), 'max_u_in'] <- mx
}
train_until1[which(breath_id==54), 'u_in']
max(train_until1[which(breath_id==54), 'u_in'])
train_until1$max_u_in <- 0
for (i in unique(train_until1$breath_id)) {
mx <- max(train_until1[which(breath_id==i), 'u_in'])
train_until1[which(breath_id==i), 'max_u_in'] <- mx
}
train_until1$last_u_in <- 0
for( i in  unique(train_until1$breath_id))
{
x = train_until1[which(breath_id==i), ]
l = dim(x)[1]
train_until1[which(breath_id==i), 'last_u_in'] <- x[l,'u_in']
}
train_until1[which(breath_id==54), 'u_in']
length(train_until1[which(breath_id==54), 'u_in'])
train_until1$u_in_diff1 <- 0
train_until1$u_in_diff2 <- 0
for (i in unique(train_until1$breath_id)) {
xx <- train_until1[which(breath_id==i), 'u_in']
l <- length(xx)
shift <- c(0, 0, xx)
train_until1[which(breath_id==i), 'u_in_diff1'] <- shift[3:(l+2)] - shift[2:(l+1)]
train_until1[which(breath_id==i), 'u_in_diff2'] <- shift[3:(l+2)] - shift[1:l]
}
train_until1$u_in_diff_max <- 0
for (i in unique(train_until1$breath_id)) {
train_until1[which(breath_id==i), 'u_in_diff_max'] <- train_until1[which(breath_id==i), 'u_in'] - train_until1[which(breath_id==i), 'max_u_in']
}
train_until1$n_change_sign_u_in <- 0
for (i in unique(train_until1$breath_id)) {
x <- train_until1[which(breath_id==i), 'u_in_diff1']
signs <- sign(x)
ss <- sum(signs[-1] != signs[-length(x)])
train_until1[which(breath_id==i), 'n_change_sign_u_in'] <- ss
}
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
ts = rbind(ts, x1[l,])
}
### CLUSTER
plot(ts$n_change_sign_u_in)
cl.e <- dist(ts$n_change_sign_u_in, method='euclidean')
cl.ew <- hclust(cl.e, method='ward')
View(ts)
x1 = train_until1[which(breath_id==54), ]
x1 = train_until1[which(breath_id==i), ]
xd1
x1
View(x1)
x1 = train_until1[which(breath_id==54), ]
View(x1)
dim(x1)
l = dim(x1)[1]
l
x1[l,]
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
ts = rbind(ts, x1[l,])
}
View(ts)
tsssss = data.frame()
for(i in unique(train_until1$breath_id))
{
xxx = train_until1[which(breath_id==i), ]
tsssss = rbind(ts, xxx[1,])
}
View(tsssss)
View(train_until1)
View(train_s)
View(train_s)
train_until1 <- train_s %>%
filter(train_s$u_out == 0)
View(train_until1)
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
ts = rbind(ts, x1[l,])
}
View(ts)
detach(train_s)
detach(train_until1)
detach(train_until1)
attach(train_until1)
ts = data.frame()
for(i in unique(train_until1$breath_id))
{
x1 = train_until1[which(breath_id==i), ]
l = dim(x1)[1]
ts = rbind(ts, x1[l,])
}
View(ts)
### CLUSTER
plot(ts$n_change_sign_u_in)
cl.e <- dist(ts$n_change_sign_u_in, method='euclidean')
cl.ew <- hclust(cl.e, method='ward')
plot(cl.ew, main='euclidean-ward', hang=-0.1, xlab='', labels=F, cex=0.6, sub='')
rect.hclust(cl.ew, k=2)
cluster.ew <- cutree(cl.ew, k=2)
plot(ts$n_change_sign_u_in, col = cluster.ew)
j = 1
for(i in seq(1,length(train_s$id),80) ){
train_s[i:(i+79),'clust'] = cluster.ew[j]
j = j +1
}
func_data4=data.frame()
for(i in unique(train_until1$breath_id) ){
x4=train_until1[which(breath_id==i), 'pressure']
func_data4 = rbind(func_data4, t(x4))
}
grid <-  seq( 1, 80)
f_data4 <- fData(grid,func_data4)
plot(f_data4,main="pressure")
times = as.matrix(func_data1)
pr = as.matrix(func_data4)
x11()
matplot(t(times),t(pr), type='l', xlab='x', ylab='orig.func', col= clu)
View(times)
func_data1=data.frame()
for(i in unique(train_until1$breath_id)  ){
x1=train_until1[which(breath_id==i),'time_step']
func_data1 = rbind(func_data1, t(x1))
}
times = as.matrix(func_data1)
x11()
matplot(t(times),t(pr), type='l', xlab='x', ylab='orig.func', col= clu)
x11()
matplot(t(times),t(pr), type='l', xlab='x', ylab='orig.func', col= clu)
func_data1=data.frame()
for(i in unique(train_until1$breath_id)  ){
x1=train_until1[which(breath_id==i),'time_step']
func_data1 = rbind(func_data1, t(x1))
}
#u_in
func_data2=data.frame()
for(i in unique(train_until1$breath_id) ){
x2=train_until1[which(breath_id==i), 'u_in']
func_data2 = rbind(func_data2, t(x2))
}
grid <-  seq( 1, 80)
f_data2 <- fData(grid,func_data2)
plot(f_data2,main="in")
